{"ast":null,"code":"import { CHANGE_PLAYLIST, CHANGE_CURRENT_INDEX } from './constants';\nimport { sendReqToGetSongDetail } from '@/service/player'; // 获取歌曲详情用于添加到播放列表\n\nexport const addToPlaylist = data => ({\n  type: CHANGE_PLAYLIST,\n  data\n});\nexport const addToPlaylistAsync = id => {\n  return (dispatch, getState) => {\n    // 先判断播放列表中是否已存在该歌曲\n    const playlist = getState().getIn(['player', 'playlist']);\n\n    if (playlist.findIndex(obj => obj.id === id) !== -1) {\n      return;\n    }\n\n    sendReqToGetSongDetail(id).then(res => {\n      // console.log('action', playlist);\n      res.songs && dispatch(addToPlaylist([...playlist, res.songs[0]]));\n    });\n  };\n}; // 播放音乐，修改当前索引值\n\nexport const changeCurrentSong = data => ({\n  type: CHANGE_CURRENT_INDEX,\n  data\n});\nexport const changeCurrentSongAsync = id => {\n  return (dispatch, getState) => {\n    // 先查找播放列表是否存在该歌曲\n    const playlist = getState().getIn(['player', 'playlist']); // 若存在，则修改当前歌曲的索引为查找到的索引值\n\n    const index = playlist.findIndex(obj => obj.id === id);\n\n    if (index !== -1) {\n      dispatch(changeCurrentSong(index));\n    } else {\n      // 若不存在，则发送请求获取详情，（1）添加到播放列表，（2）修改索引值\n      sendReqToGetSongDetail(id).then(res => {\n        res.songs && dispatch(addToPlaylist([...playlist, res.songs[0]]));\n        dispatch(changeCurrentSong(playlist.length - 1));\n      });\n    }\n  };\n};","map":{"version":3,"names":["CHANGE_PLAYLIST","CHANGE_CURRENT_INDEX","sendReqToGetSongDetail","addToPlaylist","data","type","addToPlaylistAsync","id","dispatch","getState","playlist","getIn","findIndex","obj","then","res","songs","changeCurrentSong","changeCurrentSongAsync","index","length"],"sources":["F:/music_webapp/src/components/playbar/redux/action.js"],"sourcesContent":["import {CHANGE_PLAYLIST, CHANGE_CURRENT_INDEX} from './constants'\r\nimport {sendReqToGetSongDetail} from '@/service/player'\r\n\r\n// 获取歌曲详情用于添加到播放列表\r\nexport const addToPlaylist = data => ({type: CHANGE_PLAYLIST, data})\r\n\r\nexport const addToPlaylistAsync = (id) => {\r\n  return (dispatch, getState) => {\r\n    // 先判断播放列表中是否已存在该歌曲\r\n    const playlist = getState().getIn(['player', 'playlist'])\r\n    if(playlist.findIndex(obj => obj.id === id) !== -1){\r\n      return\r\n    }\r\n    sendReqToGetSongDetail(id).then(res => {\r\n      // console.log('action', playlist);\r\n      res.songs && dispatch(addToPlaylist([...playlist, res.songs[0]]))\r\n    })\r\n  }\r\n}\r\n\r\n// 播放音乐，修改当前索引值\r\nexport const changeCurrentSong = data => ({type: CHANGE_CURRENT_INDEX, data})\r\n\r\nexport const changeCurrentSongAsync = (id) => {\r\n  return (dispatch, getState) => {\r\n    // 先查找播放列表是否存在该歌曲\r\n    const playlist = getState().getIn(['player', 'playlist'])\r\n    // 若存在，则修改当前歌曲的索引为查找到的索引值\r\n    const index = playlist.findIndex(obj => obj.id === id)\r\n    if(index !== -1){\r\n      dispatch(changeCurrentSong(index))\r\n    } else {\r\n      // 若不存在，则发送请求获取详情，（1）添加到播放列表，（2）修改索引值\r\n      sendReqToGetSongDetail(id).then(res => {\r\n        res.songs && dispatch(addToPlaylist([...playlist, res.songs[0]]))\r\n        dispatch(changeCurrentSong(playlist.length - 1))\r\n      })\r\n    }\r\n  }\r\n}"],"mappings":"AAAA,SAAQA,eAAR,EAAyBC,oBAAzB,QAAoD,aAApD;AACA,SAAQC,sBAAR,QAAqC,kBAArC,C,CAEA;;AACA,OAAO,MAAMC,aAAa,GAAGC,IAAI,KAAK;EAACC,IAAI,EAAEL,eAAP;EAAwBI;AAAxB,CAAL,CAA1B;AAEP,OAAO,MAAME,kBAAkB,GAAIC,EAAD,IAAQ;EACxC,OAAO,CAACC,QAAD,EAAWC,QAAX,KAAwB;IAC7B;IACA,MAAMC,QAAQ,GAAGD,QAAQ,GAAGE,KAAX,CAAiB,CAAC,QAAD,EAAW,UAAX,CAAjB,CAAjB;;IACA,IAAGD,QAAQ,CAACE,SAAT,CAAmBC,GAAG,IAAIA,GAAG,CAACN,EAAJ,KAAWA,EAArC,MAA6C,CAAC,CAAjD,EAAmD;MACjD;IACD;;IACDL,sBAAsB,CAACK,EAAD,CAAtB,CAA2BO,IAA3B,CAAgCC,GAAG,IAAI;MACrC;MACAA,GAAG,CAACC,KAAJ,IAAaR,QAAQ,CAACL,aAAa,CAAC,CAAC,GAAGO,QAAJ,EAAcK,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAd,CAAD,CAAd,CAArB;IACD,CAHD;EAID,CAVD;AAWD,CAZM,C,CAcP;;AACA,OAAO,MAAMC,iBAAiB,GAAGb,IAAI,KAAK;EAACC,IAAI,EAAEJ,oBAAP;EAA6BG;AAA7B,CAAL,CAA9B;AAEP,OAAO,MAAMc,sBAAsB,GAAIX,EAAD,IAAQ;EAC5C,OAAO,CAACC,QAAD,EAAWC,QAAX,KAAwB;IAC7B;IACA,MAAMC,QAAQ,GAAGD,QAAQ,GAAGE,KAAX,CAAiB,CAAC,QAAD,EAAW,UAAX,CAAjB,CAAjB,CAF6B,CAG7B;;IACA,MAAMQ,KAAK,GAAGT,QAAQ,CAACE,SAAT,CAAmBC,GAAG,IAAIA,GAAG,CAACN,EAAJ,KAAWA,EAArC,CAAd;;IACA,IAAGY,KAAK,KAAK,CAAC,CAAd,EAAgB;MACdX,QAAQ,CAACS,iBAAiB,CAACE,KAAD,CAAlB,CAAR;IACD,CAFD,MAEO;MACL;MACAjB,sBAAsB,CAACK,EAAD,CAAtB,CAA2BO,IAA3B,CAAgCC,GAAG,IAAI;QACrCA,GAAG,CAACC,KAAJ,IAAaR,QAAQ,CAACL,aAAa,CAAC,CAAC,GAAGO,QAAJ,EAAcK,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAd,CAAD,CAAd,CAArB;QACAR,QAAQ,CAACS,iBAAiB,CAACP,QAAQ,CAACU,MAAT,GAAkB,CAAnB,CAAlB,CAAR;MACD,CAHD;IAID;EACF,CAdD;AAeD,CAhBM"},"metadata":{},"sourceType":"module"}