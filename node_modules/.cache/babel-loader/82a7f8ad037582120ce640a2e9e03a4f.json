{"ast":null,"code":"import { KEY_PREFIX, REHYDRATE } from './constants';\nimport createAsyncLocalStorage from './defaults/asyncLocalStorage';\nimport purgeStoredState from './purgeStoredState';\nimport stringify from 'json-stringify-safe';\nexport default function createPersistor(store, config) {\n  // defaults\n  var serializer = config.serialize === false ? function (data) {\n    return data;\n  } : defaultSerializer;\n  var deserializer = config.serialize === false ? function (data) {\n    return data;\n  } : defaultDeserializer;\n  var blacklist = config.blacklist || [];\n  var whitelist = config.whitelist || false;\n  var transforms = config.transforms || [];\n  var debounce = config.debounce || false;\n  var keyPrefix = config.keyPrefix !== undefined ? config.keyPrefix : KEY_PREFIX; // pluggable state shape (e.g. immutablejs)\n\n  var stateInit = config._stateInit || {};\n  var stateIterator = config._stateIterator || defaultStateIterator;\n  var stateGetter = config._stateGetter || defaultStateGetter;\n  var stateSetter = config._stateSetter || defaultStateSetter; // storage with keys -> getAllKeys for localForage support\n\n  var storage = config.storage || createAsyncLocalStorage('local');\n\n  if (storage.keys && !storage.getAllKeys) {\n    storage.getAllKeys = storage.keys;\n  } // initialize stateful values\n\n\n  var lastState = stateInit;\n  var paused = false;\n  var storesToProcess = [];\n  var timeIterator = null;\n  store.subscribe(function () {\n    if (paused) return;\n    var state = store.getState();\n    stateIterator(state, function (subState, key) {\n      if (!passWhitelistBlacklist(key)) return;\n      if (stateGetter(lastState, key) === stateGetter(state, key)) return;\n      if (storesToProcess.indexOf(key) !== -1) return;\n      storesToProcess.push(key);\n    }); // time iterator (read: debounce)\n\n    if (timeIterator === null) {\n      timeIterator = setInterval(function () {\n        if (storesToProcess.length === 0) {\n          clearInterval(timeIterator);\n          timeIterator = null;\n          return;\n        }\n\n        var key = storesToProcess[0];\n        var storageKey = createStorageKey(key);\n        var endState = transforms.reduce(function (subState, transformer) {\n          return transformer.in(subState, key);\n        }, stateGetter(store.getState(), key));\n        if (typeof endState !== 'undefined') storage.setItem(storageKey, serializer(endState), warnIfSetError(key));\n        storesToProcess.shift();\n      }, debounce);\n    }\n\n    lastState = state;\n  });\n\n  function passWhitelistBlacklist(key) {\n    if (whitelist && whitelist.indexOf(key) === -1) return false;\n    if (blacklist.indexOf(key) !== -1) return false;\n    return true;\n  }\n\n  function adhocRehydrate(incoming) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var state = {};\n\n    if (options.serial) {\n      stateIterator(incoming, function (subState, key) {\n        try {\n          var data = deserializer(subState);\n          var value = transforms.reduceRight(function (interState, transformer) {\n            return transformer.out(interState, key);\n          }, data);\n          state = stateSetter(state, key, value);\n        } catch (err) {\n          if (process.env.NODE_ENV !== 'production') console.warn('Error rehydrating data for key \"' + key + '\"', subState, err);\n        }\n      });\n    } else state = incoming;\n\n    store.dispatch(rehydrateAction(state));\n    return state;\n  }\n\n  function createStorageKey(key) {\n    return '' + keyPrefix + key;\n  } // return `persistor`\n\n\n  return {\n    rehydrate: adhocRehydrate,\n    pause: function pause() {\n      paused = true;\n    },\n    resume: function resume() {\n      paused = false;\n    },\n    purge: function purge(keys) {\n      return purgeStoredState({\n        storage: storage,\n        keyPrefix: keyPrefix\n      }, keys);\n    }\n  };\n}\n\nfunction warnIfSetError(key) {\n  return function setError(err) {\n    if (err && process.env.NODE_ENV !== 'production') {\n      console.warn('Error storing data for key:', key, err);\n    }\n  };\n}\n\nfunction defaultSerializer(data) {\n  return stringify(data, null, null, function (k, v) {\n    if (process.env.NODE_ENV !== 'production') return null;\n    throw new Error('\\n      redux-persist: cannot process cyclical state.\\n      Consider changing your state structure to have no cycles.\\n      Alternatively blacklist the corresponding reducer key.\\n      Cycle encounted at key \"' + k + '\" with value \"' + v + '\".\\n    ');\n  });\n}\n\nfunction defaultDeserializer(serial) {\n  return JSON.parse(serial);\n}\n\nfunction rehydrateAction(data) {\n  return {\n    type: REHYDRATE,\n    payload: data\n  };\n}\n\nfunction defaultStateIterator(collection, callback) {\n  return Object.keys(collection).forEach(function (key) {\n    return callback(collection[key], key);\n  });\n}\n\nfunction defaultStateGetter(state, key) {\n  return state[key];\n}\n\nfunction defaultStateSetter(state, key, value) {\n  state[key] = value;\n  return state;\n}","map":{"version":3,"names":["KEY_PREFIX","REHYDRATE","createAsyncLocalStorage","purgeStoredState","stringify","createPersistor","store","config","serializer","serialize","data","defaultSerializer","deserializer","defaultDeserializer","blacklist","whitelist","transforms","debounce","keyPrefix","undefined","stateInit","_stateInit","stateIterator","_stateIterator","defaultStateIterator","stateGetter","_stateGetter","defaultStateGetter","stateSetter","_stateSetter","defaultStateSetter","storage","keys","getAllKeys","lastState","paused","storesToProcess","timeIterator","subscribe","state","getState","subState","key","passWhitelistBlacklist","indexOf","push","setInterval","length","clearInterval","storageKey","createStorageKey","endState","reduce","transformer","in","setItem","warnIfSetError","shift","adhocRehydrate","incoming","options","arguments","serial","value","reduceRight","interState","out","err","process","env","NODE_ENV","console","warn","dispatch","rehydrateAction","rehydrate","pause","resume","purge","setError","k","v","Error","JSON","parse","type","payload","collection","callback","Object","forEach"],"sources":["F:/music_webapp/node_modules/redux-persist/es/createPersistor.js"],"sourcesContent":["import { KEY_PREFIX, REHYDRATE } from './constants';\nimport createAsyncLocalStorage from './defaults/asyncLocalStorage';\nimport purgeStoredState from './purgeStoredState';\nimport stringify from 'json-stringify-safe';\n\nexport default function createPersistor(store, config) {\n  // defaults\n  var serializer = config.serialize === false ? function (data) {\n    return data;\n  } : defaultSerializer;\n  var deserializer = config.serialize === false ? function (data) {\n    return data;\n  } : defaultDeserializer;\n  var blacklist = config.blacklist || [];\n  var whitelist = config.whitelist || false;\n  var transforms = config.transforms || [];\n  var debounce = config.debounce || false;\n  var keyPrefix = config.keyPrefix !== undefined ? config.keyPrefix : KEY_PREFIX;\n\n  // pluggable state shape (e.g. immutablejs)\n  var stateInit = config._stateInit || {};\n  var stateIterator = config._stateIterator || defaultStateIterator;\n  var stateGetter = config._stateGetter || defaultStateGetter;\n  var stateSetter = config._stateSetter || defaultStateSetter;\n\n  // storage with keys -> getAllKeys for localForage support\n  var storage = config.storage || createAsyncLocalStorage('local');\n  if (storage.keys && !storage.getAllKeys) {\n    storage.getAllKeys = storage.keys;\n  }\n\n  // initialize stateful values\n  var lastState = stateInit;\n  var paused = false;\n  var storesToProcess = [];\n  var timeIterator = null;\n\n  store.subscribe(function () {\n    if (paused) return;\n\n    var state = store.getState();\n\n    stateIterator(state, function (subState, key) {\n      if (!passWhitelistBlacklist(key)) return;\n      if (stateGetter(lastState, key) === stateGetter(state, key)) return;\n      if (storesToProcess.indexOf(key) !== -1) return;\n      storesToProcess.push(key);\n    });\n\n    // time iterator (read: debounce)\n    if (timeIterator === null) {\n      timeIterator = setInterval(function () {\n        if (storesToProcess.length === 0) {\n          clearInterval(timeIterator);\n          timeIterator = null;\n          return;\n        }\n\n        var key = storesToProcess[0];\n        var storageKey = createStorageKey(key);\n        var endState = transforms.reduce(function (subState, transformer) {\n          return transformer.in(subState, key);\n        }, stateGetter(store.getState(), key));\n        if (typeof endState !== 'undefined') storage.setItem(storageKey, serializer(endState), warnIfSetError(key));\n        storesToProcess.shift();\n      }, debounce);\n    }\n\n    lastState = state;\n  });\n\n  function passWhitelistBlacklist(key) {\n    if (whitelist && whitelist.indexOf(key) === -1) return false;\n    if (blacklist.indexOf(key) !== -1) return false;\n    return true;\n  }\n\n  function adhocRehydrate(incoming) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var state = {};\n    if (options.serial) {\n      stateIterator(incoming, function (subState, key) {\n        try {\n          var data = deserializer(subState);\n          var value = transforms.reduceRight(function (interState, transformer) {\n            return transformer.out(interState, key);\n          }, data);\n          state = stateSetter(state, key, value);\n        } catch (err) {\n          if (process.env.NODE_ENV !== 'production') console.warn('Error rehydrating data for key \"' + key + '\"', subState, err);\n        }\n      });\n    } else state = incoming;\n\n    store.dispatch(rehydrateAction(state));\n    return state;\n  }\n\n  function createStorageKey(key) {\n    return '' + keyPrefix + key;\n  }\n\n  // return `persistor`\n  return {\n    rehydrate: adhocRehydrate,\n    pause: function pause() {\n      paused = true;\n    },\n    resume: function resume() {\n      paused = false;\n    },\n    purge: function purge(keys) {\n      return purgeStoredState({ storage: storage, keyPrefix: keyPrefix }, keys);\n    }\n  };\n}\n\nfunction warnIfSetError(key) {\n  return function setError(err) {\n    if (err && process.env.NODE_ENV !== 'production') {\n      console.warn('Error storing data for key:', key, err);\n    }\n  };\n}\n\nfunction defaultSerializer(data) {\n  return stringify(data, null, null, function (k, v) {\n    if (process.env.NODE_ENV !== 'production') return null;\n    throw new Error('\\n      redux-persist: cannot process cyclical state.\\n      Consider changing your state structure to have no cycles.\\n      Alternatively blacklist the corresponding reducer key.\\n      Cycle encounted at key \"' + k + '\" with value \"' + v + '\".\\n    ');\n  });\n}\n\nfunction defaultDeserializer(serial) {\n  return JSON.parse(serial);\n}\n\nfunction rehydrateAction(data) {\n  return {\n    type: REHYDRATE,\n    payload: data\n  };\n}\n\nfunction defaultStateIterator(collection, callback) {\n  return Object.keys(collection).forEach(function (key) {\n    return callback(collection[key], key);\n  });\n}\n\nfunction defaultStateGetter(state, key) {\n  return state[key];\n}\n\nfunction defaultStateSetter(state, key, value) {\n  state[key] = value;\n  return state;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}